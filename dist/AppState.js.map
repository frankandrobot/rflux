{"version":3,"sources":["AppState.js"],"names":[],"mappings":";;;;;;;;QAyBgB,a,GAAA,a;QA0BA,mB,GAAA,mB;;AAnDhB;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;AAGA,IAAM,WAAW,EAAjB;;AAEA,IAAM,aAAa,EAAnB;AACA,IAAM,mBAAmB,EAAzB;;;;;;;;;;;;;;;AAeO,SAAS,aAAT,CAAuB,OAAvB,QAAyF;AAAA,MAAxD,OAAwD,QAAxD,OAAwD;AAAA,MAA/C,QAA+C,QAA/C,QAA+C;AAAA,MAArC,eAAqC,QAArC,eAAqC;AAAA,MAApB,iBAAoB,QAApB,iBAAoB;;;AAE9F,MAAM,QAAQ,2BAAY,OAAZ,EAAqB,EAAC,gBAAD,EAAU,kBAAV,EAAoB,gCAApB,EAAqC,oCAArC,EAArB,0BAAd;;;AAGA,aAAW,IAAX,CAAgB,KAAhB;;;AAGA,MAAM,mBAAmB,WAAW,GAAX,CAAe;AAAA,WAAK,EAAE,UAAP;AAAA,GAAf,CAAzB;AACA,MAAM,qBAAqB,gBAAM,OAAN,CAAc,gBAAd,EAAgC;AAAA,sCAAI,WAAJ;AAAI,iBAAJ;AAAA;;AAAA,WACzD,YAAY,MAAZ,CACE,UAAC,MAAD,EAAS,KAAT,EAAgB,CAAhB;AAAA,aAAsB,OAAO,MAAP,CAAc,MAAd,2BAA2B,WAAW,CAAX,EAAc,IAAzC,EAAkD,MAAM,KAAxD,EAAtB;AAAA,KADF,EACyF,EADzF,CADyD;AAAA,GAAhC,CAA3B;;AAMA,SAAO,MAAP,CAAc,QAAd,EAAwB,EAAC,sCAAD,EAAxB;;;AAGA,SAAO,MAAP,CAAc,QAAd,eAA4B,MAAM,KAAlC;;;AAGA,QAAM,UAAN,CAAiB,OAAjB,CAAyB;AAAA,WACvB,CAAC,MAAM,WAAN,IAAqB,EAAtB,EAA0B,OAA1B,CAAkC;AAAA,aAAc,WAAW;AAAA,eAAM,wBAAc,IAAd,CAAmB,UAAnB,CAAN;AAAA,OAAX,EAAiD,CAAjD,CAAd;AAAA,KAAlC,CADuB;AAAA,GAAzB;AAGD;;AAEM,SAAS,mBAAT,CAA6B,OAA7B,SAAoG;AAAA,MAA7D,WAA6D,SAA7D,WAA6D;AAAA,MAAhD,yBAAgD,SAAhD,yBAAgD;AAAA,MAArB,kBAAqB,SAArB,kBAAqB;;;AAEzG,MAAM,sBAAsB,iCAAkB,OAAlB,EAA2B,EAAC,wBAAD,EAAc,oDAAd,EAAyC,sCAAzC,EAA3B,CAA5B;AACA,MAAM,cAAc,6CAAmC,QAAnC,CAApB;;;AAGA,mBAAiB,IAAjB,CAAsB,WAAtB;;;AAGA,SAAO,MAAP,CAAc,QAAd,EAAwB,YAAY,WAApC;;;AAGA,cAAY,UAAZ,CAAuB,OAAvB,CAA+B;AAAA,WAAM,SAAN;AAAA,GAA/B;AACD;;kBAEc,Q","file":"AppState.js","sourcesContent":["import Kefir from 'kefir'\n\nimport AppDispatcher from './AppDispatcher'\nimport createStore from './createStore'\nimport createSideEffects from './createSideEffects'\n\n\nconst AppState = {}\n\nconst _storeInfo = []\nconst _sideEffectsInfo = []\n\n/**\n * See #createStore for docs.\n *\n * This creates the store, adds it to the store info collection,\n * then recreates the combined AppState observable (optional)\n *\n * @param storeName\n * @param channel\n * @param Actions\n * @param Reducers\n * @param ActionFunctions\n * @param ActionObservables\n */\nexport function registerStore(channel, {Actions, Reducers, ActionFunctions, ActionObservables}) {\n\n  const store = createStore(channel, {Actions, Reducers, ActionFunctions, ActionObservables})(AppDispatcher)\n\n  // add store to store info collection\n  _storeInfo.push(store)\n\n  // update app state observable with latest\n  const storeObservables = _storeInfo.map(x => x.observable)\n  const appStateObservable = Kefir.combine(storeObservables, (...observables) =>\n    observables.reduce(\n      (stores, store, i) => Object.assign(stores, {[`${_storeInfo[i].name}`]: store.state}), {}\n    )\n  )\n\n  Object.assign(AppState, {appStateObservable})\n\n  // add store to AppState\n  Object.assign(AppState, {...store.store})\n\n  // setup one-way data flow + side effects\n  store.observable.onValue(state =>\n    (state.sideEffects || []).forEach(sideEffect => setTimeout(() => AppDispatcher.emit(sideEffect), 0))\n  )\n}\n\nexport function registerSideEffects(channel, {SideEffects, SideEffectActionFunctions, SideEffectHandlers}) {\n\n  const sideEffectsFunction = createSideEffects(channel, {SideEffects, SideEffectActionFunctions, SideEffectHandlers})\n  const sideEffects = sideEffectsFunction(AppDispatcher, AppState)\n\n  // store side effects\n  _sideEffectsInfo.push(sideEffects)\n\n  // add side effect action functions to app state\n  Object.assign(AppState, sideEffects.sideEffects)\n\n  // setup one-way data flow\n  sideEffects.observable.onValue(() => undefined)\n}\n\nexport default AppState\n"]}